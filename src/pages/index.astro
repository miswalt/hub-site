---
import { projects, featuredProject } from "../data/projects";
import type { Project, ProjectGroup, ProjectPlatform } from "../data/projects";

// SVG strings (rendered safely with set:html)
const ICONS: Record<ProjectPlatform, string> = {
  Streamlit: `
    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
      <path d="M7 14c3-2 7-3 10-2 2 1 2 3 0 4-3 2-7 3-10 2-2-1-2-3 0-4Z"></path>
      <path d="M8 7c3-2 6-2 9-1 2 1 2 3 0 4-3 2-6 2-9 1-2-1-2-3 0-4Z" opacity="0.6"></path>
    </svg>
  `,
  Replit: `
    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
      <path d="M6 7h12a2 2 0 0 1 2 2v6a4 4 0 0 1-4 4H10a6 6 0 0 1-6-6V9a2 2 0 0 1 2-2Z"></path>
      <path d="M9 11h6" opacity="0.6"></path>
      <path d="M9 14h4" opacity="0.6"></path>
    </svg>
  `,
  Vercel: `
    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
      <path d="M12 4l9 16H3l9-16Z"></path>
    </svg>
  `,
};

const iconFor = (platform: ProjectPlatform) => ICONS[platform] ?? "";

// ---- grouping order + labels
const GROUP_ORDER: ProjectGroup[] = ["microtransit", "transit", "planning", "micromobility"];

const GROUP_LABELS: Record<ProjectGroup, string> = {
  microtransit: "Microtransit/Shared Mobility",
  transit: "Transit Analytics",
  planning: "Planning Demos",
  micromobility: "Micromobility",
};

// Exclude featured from grid if it exists as a card
const filteredProjects = projects.filter(
  (p) => p.slug !== "moda-tool" && p.href !== featuredProject.href
);

// Group projects (keep original order within each group)
const grouped: { group: ProjectGroup; label: string; items: Project[] }[] = GROUP_ORDER
  .map((g) => ({
    group: g,
    label: GROUP_LABELS[g],
    items: filteredProjects.filter((p) => p.group === g),
  }))
  .filter((x) => x.items.length > 0);

// Helper for display
const MODA_TITLE = "MODA";
const MODA_SUBTITLE = "Microtransit On-Demand Analysis Tool";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mike Iswalt</title>

    <style>
      :root {
        --bg: #ffffff;
        --fg: #0b0c0f;
        --muted: rgba(0, 0, 0, 0.65);
        --muted2: rgba(0, 0, 0, 0.12);
        --card: #ffffff;
        --shadow: rgba(0, 0, 0, 0.06);
        --accent: rgba(0, 0, 0, 0.92);
        --tag: rgba(0, 0, 0, 0.05);
      }
      @media (prefers-color-scheme: dark) {
        :root {
          --bg: #0b0c0f;
          --fg: #f3f4f6;
          --muted: rgba(255, 255, 255, 0.72);
          --muted2: rgba(255, 255, 255, 0.14);
          --card: #111318;
          --shadow: rgba(0, 0, 0, 0.38);
          --accent: rgba(255, 255, 255, 0.92);
          --tag: rgba(255, 255, 255, 0.08);
        }
      }

      body {
        margin: 0;
        background: var(--bg);
        color: var(--fg);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      }

      /* Container */
      .wrap {
        max-width: 1180px;
        margin: 0 auto;
        padding: 44px 22px 50px;
      }
      @media (min-width: 820px) {
        .wrap { padding-left: 34px; padding-right: 34px; }
      }
      @media (min-width: 1100px) {
        .wrap { padding-left: 44px; padding-right: 44px; }
      }

      /* ---------- HERO ---------- */
      .hero {
        padding: 34px 0 10px;
      }
      .heroInner {
        max-width: 1180px;
        margin: 0 auto;
        padding: 0 22px;
      }
      @media (min-width: 820px) {
        .heroInner { padding-left: 34px; padding-right: 34px; }
      }
      @media (min-width: 1100px) {
        .heroInner { padding-left: 44px; padding-right: 44px; }
      }

      /* Welcome row */
      .welcomeRow {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 14px;
      }
      .welcomeTitle {
        /* same size as MODA heading */
        font-size: 44px;
        margin: 0;
        letter-spacing: -0.02em;
        line-height: 1.06;
      }
      .welcomeTagline {
        margin: 10px 0 0;
        color: var(--muted);
        line-height: 1.45;
        max-width: 72ch;
        font-size: 16px;
      }
      .welcomeActions {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }
      @media (max-width: 760px) {
        .welcomeRow {
          flex-direction: column;
          align-items: flex-start;
        }
      }

      /* Thin divider before featured */
      .siteDivider {
        height: 1px;
        background: linear-gradient(to right, transparent, var(--muted2), transparent);
        margin: 18px 0 22px;
      }

      .heroTop {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 10px;
      }
      @media (max-width: 560px) {
        .heroTop { flex-direction: column; align-items: flex-start; }
      }

      .heroKicker {
        font-size: 13px;
        opacity: 0.8;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .heroKicker img {
        width: 38px;
        height: 38px;
        border-radius: 12px;
        border: 1px solid var(--muted2);
        box-shadow: 0 10px 24px var(--shadow);
        object-fit: contain;
        background: var(--card);
        padding: 6px;
        box-sizing: border-box;
      }

      .heroTitle {
        font-size: 44px;
        margin: 10px 0 0;
        letter-spacing: -0.02em;
        line-height: 1.06;
        text-transform: uppercase; /* MODA all caps */
      }

      .heroSubtitle {
        margin: 8px 0 0;
        font-size: 18px;
        line-height: 1.45;
        opacity: 0.9;
        max-width: 72ch;
      }

      .heroDesc {
        margin: 12px 0 0;
        font-size: 16px;
        line-height: 1.55;
        color: var(--muted);
        max-width: 78ch;
      }

      .heroActions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 16px;
        align-items: center;
      }
      .heroActions .btn {
        padding: 11px 14px;
      }

      /* Screenshot should match page extents/buffer (not full-bleed) */
      .heroMedia {
        margin-top: 18px;
      }
      .heroShot {
        width: 100%;
        height: auto;
        display: block;
        border-radius: 18px;
        border: 1px solid var(--muted2);
        box-shadow: 0 18px 42px var(--shadow);
      }

      /* Buttons */
      .btn {
        display: inline-flex; align-items: center; justify-content: center;
        padding: 10px 12px;
        border-radius: 14px;
        border: 1px solid var(--muted2);
        text-decoration: none;
        font-weight: 650;
        background: var(--card);
      }
      .btn.primary { background: var(--accent); color: var(--bg); border-color: var(--accent); }

      /* ---------- OTHER APPS ---------- */
      .topbar {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 18px;
      }
      @media (max-width: 560px) {
        .topbar { flex-direction: column; align-items: flex-start; }
      }

      .brand { display: grid; gap: 8px; }
      .kicker { font-size: 13px; opacity: 0.8; letter-spacing: 0.08em; text-transform: uppercase; }
      h1 { font-size: 40px; margin: 0; letter-spacing: -0.02em; }
      .tagline { margin: 0; font-size: 18px; line-height: 1.45; opacity: 0.86; max-width: 62ch; }

      .subtag {
        margin: 0;
        font-size: 14px;
        line-height: 1.45;
        color: var(--muted);
        opacity: 0.9;
        max-width: 78ch;
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 18px;
        margin-top: 16px;
      }
      @media (min-width: 860px) {
        .grid {
          grid-template-columns: repeat(2, minmax(460px, 1fr));
          column-gap: 22px;
          row-gap: 20px;
          align-items: stretch;
        }
      }

      .section {
        grid-column: 1 / -1;
        padding: 10px 6px 2px;
        margin-top: 4px;
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
      }
      .section h2 {
        margin: 0;
        font-size: 14px;
        letter-spacing: 0.09em;
        text-transform: uppercase;
        opacity: 0.85;
      }
      .section .rule {
        height: 1px;
        background: var(--muted2);
        flex: 1;
        border-radius: 999px;
        opacity: 0.95;
      }

      .section-spacer {
        grid-column: 1 / -1;
        height: 14px;
      }

      .card {
        border: 1px solid var(--muted2);
        border-radius: 18px;
        padding: 16px;
        background: var(--card);
        box-shadow: 0 10px 28px var(--shadow);

        display: flex;
        flex-direction: column;
        gap: 10px;
        height: 100%;
      }

      .full {
        grid-column: 1 / -1;
      }

      .head { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
      .left { display: flex; align-items: center; gap: 10px; min-width: 0; }
      .title { font-size: 18px; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

      .pill {
        display: inline-flex; align-items: center; gap: 8px;
        font-size: 12px; padding: 6px 10px; border-radius: 999px;
        border: 1px solid var(--muted2); opacity: 0.9;
      }

      .desc { margin: 0; color: var(--muted); line-height: 1.45; }

      .tags { display: flex; flex-wrap: wrap; gap: 8px; }
      .tag { font-size: 12px; padding: 5px 9px; border-radius: 999px; background: var(--tag); }

      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: auto;
      }

      .hint { font-size: 13px; opacity: 0.65; align-self: center; }
      .icon { width: 16px; height: 16px; fill: currentColor; }

      .footer { margin-top: 34px; opacity: 0.75; font-size: 14px; display: flex; gap: 12px; flex-wrap: wrap; }
      a { color: inherit; }
    </style>
  </head>

  <body>
    <!-- =========================
         HERO (Welcome + Featured)
         ========================= -->
    <header class="hero">
      <div class="heroInner">
        <!-- Welcome row -->
        <div class="welcomeRow">
          <div>
            <h2 class="welcomeTitle">Welcome to MikeIswalt.com</h2>
            <p class="welcomeTagline">
              A website showing some of my demonstration analysis products and tools.
            </p>
          </div>

          <div class="welcomeActions">
            <a class="btn" href="/about">About Me</a>
            <a class="btn" href="/contact">Contact</a>
          </div>
        </div>

        <!-- Subtle divider before featured -->
        <div class="siteDivider" aria-hidden="true"></div>

        <div class="heroTop">
          <div>
            <div class="heroKicker">
              <img src={featuredProject.iconSrc} alt="" />
              <span>{featuredProject.platform}</span>
            </div>

            <h1 class="heroTitle">{MODA_TITLE}</h1>
            <p class="heroSubtitle">{MODA_SUBTITLE}</p>
            <p class="heroDesc">{featuredProject.description}</p>

            <div class="heroActions">
              <a class="btn primary" href={featuredProject.href} target="_blank" rel="noopener noreferrer">
                Launch Moda Tool →
              </a>
              <a class="btn" href="#projects">
                View other apps
              </a>

              <span class="pill" style="margin-left: 4px;">
                <span set:html={iconFor(featuredProject.platform)} />
                {featuredProject.platform}
              </span>
            </div>
          </div>
        </div>

        <!-- Screenshot aligned to page extents -->
        <div class="heroMedia">
          <img
            class="heroShot"
            src={featuredProject.screenshotSrc}
            alt={featuredProject.screenshotAlt}
            loading="eager"
          />
        </div>
      </div>
    </header>

    <!-- =========================
         OTHER APPS (Grid below)
         ========================= -->
    <div class="wrap" id="projects">
      <div class="topbar">
        <div class="brand">
          <div class="kicker">Apps & Experiments</div>
          <h1>Other apps</h1>
          <p class="tagline">
            Demo apps for shared mobility/microtansit, transit analytics, urban planning, and other areas.
          </p>
          <p class="subtag">
            Mike is a consultant with 20 years of experience developing open-source tools to solve planning problems.
          </p>
        </div>
      </div>

      <div class="grid">
        {grouped.map((g) => (
          <>
            <div class="section">
              <h2>{g.label}</h2>
              <div class="rule" aria-hidden="true"></div>
            </div>

            {g.items.map((p) => {
              const isFull = p.span === "full";
              return (
                <div class={isFull ? "full" : ""}>
                  <article class="card">
                    <div class="head">
                      <div class="left">
                        <h3 class="title">{p.title}</h3>
                      </div>

                      <span class="pill">
                        <span set:html={iconFor(p.platform)} />
                        {p.platform}
                      </span>
                    </div>

                    <p class="desc">{p.description}</p>

                    {p.tags?.length ? (
                      <div class="tags">
                        {p.tags.map((t) => <span class="tag">{t}</span>)}
                      </div>
                    ) : null}

                    <div class="actions">
                      <a class="btn primary" href={p.href} target="_blank" rel="noopener noreferrer">
                        Launch app →
                      </a>
                      <span class="hint">{p.platform} deployment</span>
                    </div>
                  </article>
                </div>
              );
            })}

            <div class="section-spacer" aria-hidden="true"></div>
          </>
        ))}
      </div>

      <div class="footer">
        <a href="/about">About</a>
        <span>·</span>
        <a href="/contact">Contact</a>
      </div>
    </div>
  </body>
</html>
